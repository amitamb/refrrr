<?php 

require_once('framework/basicFrameworkInclude.php');

require_once('constants/user.php');

define ("SHOW_LOGIN", "showLogin");
define ("SHOW_REGISTER", "showRegister");
define ("PROCESS_REGISTER", "processRegister");
define ("PROCESS_LOGIN", "processLogin");
define ("LOGOUT", "logout");

class User
{
	public static function processMethod($method)
	{
		if ($method == PROCESS_LOGIN)
		{
			User::processLogin();			
		}
		elseif ($method == SHOW_LOGIN)
		{
			User::printLoginForm();
		}
		elseif ($method == LOGOUT)
		{
			User::logout();				
		}
	}	
	
	public static function printLoginForm()
	{
		//Show login
		$inputs = array();
		
		$inputs[] = new Input('text', USERNAME, USERNAME, '', 'Username');
		$inputs[] = new Input('password', PASSWORD, PASSWORD, '', 'Password');
		$inputs[] = new Input('submit', '', '', 'Submit', '');
		
		showForm($inputs, 'user.php?'.METHOD.'='.PROCESS_LOGIN, POST);
	}
	
	public static function showLogoutButton()
	{
		print "<a href='user.php?".METHOD."=".LOGOUT."'>Logout</a>";		
	}

	public static function processLogin()
	{
		$username = requestParam(USERNAME);
		$password = requestParam(PASSWORD);
		if (User::isCredentialsCorrect($username, $password))
		{
			session_start();
			session_destroy();
			session_start();
			$_SESSION[USERNAME]=$username;
			redirectSuccess('index.php');
		}
		else
		{
			redirectFailure('user.php?'.METHOD."=".SHOW_LOGIN);
		}
	}
	
	public static function logout()
	{
		session_start();
		session_destroy();
		redirectSuccess('index.php');
	}
	
	public static function isLoggedIn()
	{
		session_start();
		if (isset($_SESSION[USERNAME]))
		{
			return true;			
		}
		else
		{
			return false;			
		}
	}
	
	public static function isCredentialsCorrect($username, $password)
	{
		if ($username == "amit" && $password == "amit")
		{
			return true;
		}
		else
		{
			return false;			
		}
	}
	
	public static function showRegister()
	{
		
	}
	
	public static function processRegister()
	{
		
	}
}

?>
